<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Manage and track activities with real-time updates">
    <title>Activity Management</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.css" rel="stylesheet">
    <link href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.9/dist/flatpickr.min.js"></script>
    <style>
        :root {
            --bg-color: #fff;
            --text-color: #333;
            --table-bg: #fff;
            --table-border: #dee2e6;
            --btn-primary-bg: #5A2D84;
            --sidebar-gradient: linear-gradient(180deg, #2c3e50, #1a252f);
            --sidebar-glass-bg: rgba(44, 62, 80, 0.9);
            --sidebar-text: #ffffff;
            --sidebar-hover: #34495e;
            --accent-color: #7a4aa3;
            --logo-color: #e0e0e0;
            --header-bg: #2c3e50;
            --footer-bg: #1a252f;
        }
        [data-theme="dark"] {
            --bg-color: #222;
            --text-color: #ddd;
            --table-bg: #333;
            --table-border: #555;
            --btn-primary-bg: #7a4aa3;
            --sidebar-gradient: linear-gradient(180deg, #1a252f, #0f1419);
            --sidebar-glass-bg: rgba(26, 37, 47, 0.9);
            --sidebar-text: #e0e0e0;
            --sidebar-hover: #2c3e50;
            --accent-color: #9b59b6;
            --logo-color: #ffffff;
            --header-bg: #0f1419;
            --footer-bg: #0f1419;
        }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            margin: 0;
            padding: 0;
        }

        /* Header Styles */
        .navbar {
            background: var(--header-bg);
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 50px;
            width: calc(100% - 50px);
            z-index: 1100;
            transition: background 0.3s ease;
        }
        .navbar-brand {
            color: var(--logo-color) !important;
            font-size: 24px;
            font-weight: bold;
        }
        .navbar-nav .nav-link {
            color: var(--sidebar-text) !important;
            margin-left: 1rem;
            transition: color 0.2s ease;
        }
        .navbar-nav .nav-link:hover {
            color: var(--accent-color) !important;
        }

        /* Enhanced Sidebar Styles */
        .sidebar {
            width: 60px;
            height: 100vh;
            background: var(--sidebar-gradient);
            position: fixed;
            top: 56px; /* Adjusted to account for header height */
            left: 50px;
            transition: width 0.3s ease, box-shadow 0.3s ease, backdrop-filter 0.3s ease, left 0.3s ease;
            overflow-x: hidden;
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .sidebar.active {
            width: 250px;
            box-shadow: 5px 0 15px rgba(0, 0, 0, 0.2);
            background: var(--sidebar-glass-bg);
            left: 50px;
        }
        .sidebar-header {
            padding: 20px 15px;
            text-align: center;
            color: var(--logo-color);
            font-size: 24px;
            font-weight: bold;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
            transition: opacity 0.3s ease, transform 0.3s ease;
            position: relative;
        }
        .sidebar.active .sidebar-header {
            opacity: 1;
            transform: scale(1.1);
        }
        .sidebar-header span {
            display: none;
            font-family: 'Arial', sans-serif;
        }
        .sidebar.active .sidebar-header span {
            display: inline;
        }
        .sidebar-header i {
            margin-right: 10px;
            transition: transform 0.3s ease;
        }
        .sidebar.active .sidebar-header i {
            transform: rotate(360deg);
        }
        .hamburger {
            font-size: 28px;
            color: var(--sidebar-text);
            background: none;
            border: none;
            padding: 15px;
            cursor: pointer;
            width: 100%;
            text-align: left;
            transition: color 0.2s ease;
        }
        .hamburger:hover {
            color: var(--accent-color);
        }
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
            display: none;
            padding-top: 30px;
        }
        .sidebar.active .sidebar-menu {
            display: block;
        }
        .sidebar-menu li {
            margin: 15px 0;
        }
        .sidebar-menu a {
            display: flex;
            align-items: center;
            color: var(--sidebar-text);
            text-decoration: none;
            padding: 12px 15px;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.2s ease, transform 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
            border-radius: 10px;
            margin: 0 10px;
            position: relative;
            overflow: hidden;
        }
        .sidebar-menu a::before {
            content: '';
            position: absolute;
            top: 50%;
            left: -100%;
            width: 100%;
            height: 2px;
            background: var(--accent-color);
            transition: left 0.3s ease;
        }
        .sidebar-menu a:hover::before {
            left: 0;
        }
        .sidebar-menu a:hover {
            background: var(--sidebar-hover);
            color: var(--accent-color);
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .sidebar-menu a:hover i {
            animation: bounce 0.5s ease infinite;
            color: var(--accent-color);
        }
        .sidebar-menu i {
            margin-right: 15px;
            font-size: 24px;
            width: 30px;
            text-align: center;
            transition: transform 0.2s ease, color 0.2s ease;
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }

        /* Content adjustment */
        .content {
            margin-left: 110px;
            padding: 20px;
            margin-top: 70px; /* Adjusted to account for header height */
            transition: margin-left 0.3s ease;
        }
        .sidebar.active ~ .content {
            margin-left: 300px;
        }

        /* Footer Styles */
        .footer {
            background: var(--footer-bg);
            color: var(--sidebar-text);
            padding: 2rem 0;
            margin-left: 50px;
            width: calc(100% - 50px);
            position: relative;
            bottom: 0;
        }
        .footer a {
            color: var(--sidebar-text);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .footer a:hover {
            color: var(--accent-color);
        }
        .footer .list-unstyled {
            padding-left: 0;
        }
        .footer .list-unstyled li {
            margin-bottom: 0.5rem;
        }

        /* Session Warning */
        .session-warning {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            background: #f8d7da;
            color: #721c24;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        /* Enhanced Table Styles */
        .table {
            background-color: var(--table-bg);
            border-color: var(--table-border);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            font-size: 16px;
            margin-left: auto; /* Move table to the right */
            margin-right: 0; /* Ensure no margin on the right */
            width: auto; /* Allow table to adjust width naturally */
        }
        .table th, .table td {
            vertical-align: middle;
            padding: 12px;
            transition: background 0.2s ease;
        }
        .table th {
            background: linear-gradient(180deg, #f2f2f2, #e0e0e0);
            font-weight: 600;
            cursor: pointer;
            position: relative;
            color: #333;
        }
        .table th.sort-asc::after {
            content: ' ↑';
            color: var(--btn-primary-bg);
        }
        .table th.sort-desc::after {
            content: ' ↓';
            color: var(--btn-primary-bg);
        }
        .table tr:hover {
            background: rgba(90, 45, 132, 0.1);
        }
        .table .actions button, .table .actions a {
            margin: 2px;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 5px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .table .actions button:hover, .table .actions a:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        .editable:hover {
            background-color: rgba(248, 249, 250, 0.5);
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            border: 0;
        }
        .spinner {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--btn-primary-bg);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .download-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .modal-content {
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .modal-header {
            background: var(--btn-primary-bg);
            color: #fff;
            border-radius: 10px 10px 0 0;
        }
        .modal-footer button {
            border-radius: 5px;
        }
        h1 {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 40px;
            color: var(--btn-primary-bg);
            font-weight: bold;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
            text-align: center;
            margin-top: 20px;
        }
        .pagination .page-link {
            border-radius: 5px;
            margin: 0 3px;
            transition: background 0.2s ease, transform 0.2s ease;
        }
        .pagination .page-link:hover {
            background: var(--btn-primary-bg);
            color: #fff;
            transform: translateY(-2px);
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                left: 0;
            }
            .sidebar.active {
                width: 200px;
                left: 0;
            }
            .navbar {
                left: 0;
                width: 100%;
            }
            .content {
                margin-left: 0;
                margin-top: 56px;
            }
            .sidebar.active ~ .content {
                margin-left: 200px;
            }
            .footer {
                margin-left: 0;
                width: 100%;
            }
            .table {
                display: block;
                margin-left: auto; /* Move table to the right on mobile */
                margin-right: 0;
            }
            thead {
                display: none;
            }
            tr {
                display: block;
                margin-bottom: 1em;
                border-bottom: 1px solid var(--table-border);
            }
            td {
                display: block;
                text-align: left;
                padding-left: 50%;
                position: relative;
            }
            td:before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 45%;
                font-weight: bold;
            }
            .actions {
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark">
        <a class="navbar-brand" href="#">Activity Pro</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
              
            </ul>
        </div>
    </nav>

    <div class="spinner" id="spinner"></div>
    <div class="alert alert-warning session-warning" role="alert">
        Your session will expire in 1 minute. <button id="extendSession" class="btn btn-sm btn-primary">Extend</button>
    </div>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <i class="fas fa-shield-alt"></i> <span>Activity Pro</span>
        </div>
        <button class="hamburger" id="hamburger">
            <i class="fas fa-bars"></i>
        </button>
        <ul class="sidebar-menu" id="sidebarMenu">
            <li><a href="/add"><i class="fas fa-plus-circle"></i>Add New Activity</a></li>
            <li><a href="/confirmExit"><i class="fas fa-sign-out-alt"></i>Exit</a></li>
            <li><a href="#" id="bulkDelete"><i class="fas fa-trash-alt"></i>Delete Selected</a></li>
            <li><a href="#" id="exportCsv"><i class="fas fa-file-csv"></i>Export to CSV</a></li>
            <li><a href="#" id="toggleDarkMode"><i class="fas fa-moon"></i>Toggle Dark Mode</a></li>
            <li><a href="#" id="toggleColumns" data-toggle="modal" data-target="#columnModal"><i class="fas fa-columns"></i>Columns</a></li>
            <li><a href="#" id="toggleAnalytics"><i class="fas fa-chart-bar"></i>Simple Analytics</a></li>
            <li><a href="/stateCategoryQuery"><i class="fas fa-filter"></i>Query by State & Category</a></li>
            <li><a href="/dateRangeQuery"><i class="fas fa-calendar-alt"></i>Query by Date Range</a></li>
        </ul>
    </nav>
    <div class="content container">
        <h1>Activities List</h1>
        <div id="analytics-section" class="row mb-4" style="display: none;">
            <div class="col-md-6">
                <canvas id="stateChart" height="200"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="categoryChart" height="200"></canvas>
            </div>
        </div>
        <div class="modal fade" id="columnModal" tabindex="-1" role="dialog" aria-labelledby="columnModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="columnModalLabel">Select Columns</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="state" id="colState" checked>
                            <label class="form-check-label" for="colState">State</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="stationName" id="colStationName" checked>
                            <label class="form-check-label" for="colStationName">Station Name</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="activityType" id="colActivityType" checked>
                            <label class="form-check-label" for="colActivityType">Activity Type</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="eventCategory" id="colEventCategory" checked>
                            <label class="form-check-label" for="colEventCategory">Event Category</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="participantCategory" id="colParticipantCategory" checked>
                            <label class="form-check-label" for="colParticipantCategory">Participant Category</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="eventDescription" id="colEventDescription" checked>
                            <label class="form-check-label" for="colEventDescription">Event Description</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="schoolOrCollegeOrPanchayatName" id="colSchool" checked>
                            <label class="form-check-label" for="colSchool">School/College/Panchayat Name</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="eventLocation" id="colEventLocation" checked>
                            <label class="form-check-label" for="colEventLocation">Event Location</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="eventDate" id="colEventDate" checked>
                            <label class="form-check-label" for="colEventDate">Event Date</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="numberOfParticipants" id="colParticipants" checked>
                            <label class="form-check-label" for="colParticipants">Number of Participants</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input column-toggle" type="checkbox" value="remarks" id="colRemarks" checked>
                            <label class="form-check-label" for="colRemarks">Remarks</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveColumns">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <table class="table table-bordered table-striped" role="grid" aria-labelledby="activityTableDesc">
            <caption id="activityTableDesc" class="sr-only">List of activities with details and actions</caption>
            <thead>
                <tr>
                    <th scope="col" role="columnheader"><input type="checkbox" id="selectAll" aria-label="Select all activities"></th>
                    <th scope="col" data-sort="id" role="columnheader" aria-sort="none">ID</th>
                    <th scope="col" data-sort="state" data-col="state" role="columnheader" aria-sort="none">State</th>
                    <th scope="col" data-sort="stationName" data-col="stationName" role="columnheader" aria-sort="none">Station Name</th>
                    <th scope="col" data-sort="activityType" data-col="activityType" role="columnheader" aria-sort="none">Activity Type</th>
                    <th scope="col" data-sort="eventCategory" data-col="eventCategory" role="columnheader" aria-sort="none">Event Category</th>
                    <th scope="col" data-sort="participantCategory" data-col="participantCategory" role="columnheader" aria-sort="none">Participant Category</th>
                    <th scope="col" data-sort="eventDescription" data-col="eventDescription" role="columnheader" aria-sort="none">Event Description</th>
                    <th scope="col" data-sort="schoolOrCollegeOrPanchayatName" data-col="schoolOrCollegeOrPanchayatName" role="columnheader" aria-sort="none">School/College/Panchayat Name</th>
                    <th scope="col" data-sort="eventLocation" data-col="eventLocation" role="columnheader" aria-sort="none">Event Location</th>
                    <th scope="col" data-sort="eventDate" data-col="eventDate" role="columnheader" aria-sort="none">Event Date</th>
                    <th scope="col" data-sort="numberOfParticipants" data-col="numberOfParticipants" role="columnheader" aria-sort="none">Number of Participants</th>
                    <th scope="col" data-sort="remarks" data-col="remarks" role="columnheader" aria-sort="none">Remarks</th>
                    <th scope="col" role="columnheader" class="actions">Actions</th>
                </tr>
            </thead>
            <tbody id="activityTable" data-sort-order="asc">
                <tr th:each="activity : ${activities}">
                    <td data-label="Select"><input type="checkbox" class="selectRow" th:value="${activity.id}" aria-label="Select activity"></td>
                    <td data-label="ID" th:text="${activity.id}" scope="row" class="activity-id"></td>
                    <td data-label="State" contenteditable="true" class="editable" data-field="state" th:text="${activity.state}"></td>
                    <td data-label="Station Name" contenteditable="true" class="editable" data-field="stationName" th:text="${activity.stationName}"></td>
                    <td data-label="Activity Type" contenteditable="true" class="editable" data-field="activityType" th:text="${activity.activityType}"></td>
                    <td data-label="Event Category" contenteditable="true" class="editable" data-field="eventCategory" th:text="${activity.eventCategory}"></td>
                    <td data-label="Participant Category" contenteditable="true" class="editable" data-field="participantCategory" th:utext="${activity.participantCategory}"></td>
                    <td data-label="Event Description" contenteditable="true" class="editable" data-field="eventDescription" th:utext="${activity.eventDescription}"></td>
                    <td data-label="School/College/Panchayat Name" contenteditable="true" class="editable" data-field="schoolOrCollegeOrPanchayatName" th:text="${activity.schoolOrCollegeOrPanchayatName}"></td>
                    <td data-label="Event Location" contenteditable="true" class="editable" data-field="eventLocation" th:text="${activity.eventLocation}"></td>
                    <td data-label="Event Date" contenteditable="true" class="editable" data-field="eventDate" th:text="${activity.eventDate}"></td>
                    <td data-label="Number of Participants" contenteditable="true" class="editable" data-field="numberOfParticipants" th:text="${activity.numberOfParticipants}"></td>
                    <td data-label="Remarks" contenteditable="true" class="editable" data-field="remarks" th:utext="${activity.remarks}"></td>
                    <td data-label="Actions" class="actions">
                        <button class="btn btn-sm btn-success save-row" th:attr="data-id=${activity.id}" aria-label="Save changes for activity ${activity.id}">Save</button>
                        <a th:href="@{/update/{id}(id=${activity.id})}" class="btn btn-sm btn-warning" aria-label="Edit activity ${activity.id}">Edit</a>
                        <a th:href="@{/confirmDelete/{id}(id=${activity.id})}" class="btn btn-sm btn-danger" aria-label="Delete activity ${activity.id}">Delete</a>
                        <div class="dropdown" th:if="${fileMap.get(activity.id)?.size() > 0}">
                            <button class="btn btn-sm btn-primary download-btn" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" th:attr="data-id=${activity.id}">
                                Download
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" th:each="file : ${fileMap.get(activity.id)}" th:href="@{'/api/download/' + ${file.id}}" th:text="${file.fileName}"></a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item text-danger delete-files" th:attr="data-id=${activity.id}">Delete All Images</a>
                            </div>
                        </div>
                        <button class="btn btn-sm btn-primary download-btn" disabled th:unless="${fileMap.get(activity.id)?.size() > 0}" th:attr="data-id=${activity.id}" aria-label="No images available for activity ${activity.id}">Download</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                        <a class="page-link" th:href="@{/(page=${currentPage - 1},size=${size},sortBy=${sortBy},sortDir=${sortDir})}" aria-label="Previous page">Previous</a>
                    </li>
                    <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:classappend="${i == currentPage} ? 'active'">
                        <a class="page-link" th:href="@{/(page=${i},size=${size},sortBy=${sortBy},sortDir=${sortDir})}" th:text="${i + 1}" th:attr="aria-label='Page ' + ${i + 1}"></a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">
                        <a class="page-link" th:href="@{/(page=${currentPage + 1},size=${size},sortBy=${sortBy},sortDir=${sortDir})}" aria-label="Next page">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="/about">About Us</a></li>
                        <li><a href="/help">Help</a></li>
                        <li><a href="/terms">Terms of Service</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>Contact Us</h5>
                    <p>Email: support@activitypro.com</p>
                    <p>Phone: +1-800-555-1234</p>
                    <p>Address: 123 Activity Lane, Tech City, TC 12345</p>
                </div>
                <div class="col-md-4">
                    <h5>Follow Us</h5>
                    <a href="https://twitter.com/activitypro" target="_blank"><i class="fab fa-twitter"></i> Twitter</a><br>
                    <a href="https://facebook.com/activitypro" target="_blank"><i class="fab fa-facebook"></i> Facebook</a><br>
                    <a href="https://linkedin.com/company/activitypro" target="_blank"><i class="fab fa-linkedin"></i> LinkedIn</a>
                </div>
            </div>
            <hr>
            <div class="text-center">
                <p>&copy; 2025 Activity Pro. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.bundle.min.js" integrity="sha384-pjaaA8dDz/5BgdFUPX6M/9SUZv4d12SUPF0axWc+VRZkx5xU3daN+lYb49+Ax+Tl" crossorigin="anonymous"></script>
    <script>
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburger');
        const sidebarMenu = document.getElementById('sidebarMenu');

        hamburger.addEventListener('click', () => {
            sidebar.classList.toggle('active');
        });

        document.addEventListener('click', (event) => {
            if (!sidebar.contains(event.target) && sidebar.classList.contains('active')) {
                sidebar.classList.remove('active');
            }
        });

        if (localStorage.getItem('theme') === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
        }

        document.getElementById('toggleDarkMode').addEventListener('click', () => {
            const body = document.body;
            const theme = body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        });

        function showSpinner() {
            document.getElementById('spinner').style.display = 'block';
        }
        function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
        }

        document.querySelectorAll('th[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                const sortField = th.dataset.sort;
                const currentSort = th.getAttribute('aria-sort');
                const newSortDir = currentSort === 'ascending' ? 'descending' : 'ascending';
                document.querySelectorAll('th').forEach(header => {
                    header.setAttribute('aria-sort', 'none');
                    header.classList.remove('sort-asc', 'sort-desc');
                });
                th.setAttribute('aria-sort', newSortDir);
                th.classList.add(newSortDir === 'ascending' ? 'sort-asc' : 'sort-desc');
                const size = new URLSearchParams(window.location.search).get('size') || 10;
                window.location.href = `/?page=0&size=${size}&sortBy=${sortField}&sortDir=${newSortDir === 'ascending' ? 'asc' : 'desc'}`;
            });
        });

        document.querySelectorAll('.save-row').forEach(button => {
            button.addEventListener('click', () => {
                const row = button.closest('tr');
                const id = button.dataset.id;
                const data = {
                    id: id,
                    state: row.querySelector('[data-field="state"]').textContent,
                    stationName: row.querySelector('[data-field="stationName"]').textContent,
                    activityType: row.querySelector('[data-field="activityType"]').textContent,
                    eventCategory: row.querySelector('[data-field="eventCategory"]').textContent,
                    participantCategory: row.querySelector('[data-field="participantCategory"]').textContent,
                    eventDescription: row.querySelector('[data-field="eventDescription"]').innerHTML,
                    schoolOrCollegeOrPanchayatName: row.querySelector('[data-field="schoolOrCollegeOrPanchayatName"]').textContent,
                    eventLocation: row.querySelector('[data-field="eventLocation"]').textContent,
                    eventDate: row.querySelector('[data-field="eventDate"]').textContent,
                    numberOfParticipants: parseInt(row.querySelector('[data-field="numberOfParticipants"]').textContent) || 0,
                    remarks: row.querySelector('[data-field="remarks"]').innerHTML
                };
                showSpinner();
                $.ajax({
                    url: '/save',
                    method: 'POST',
                    contentType: 'application/x-www-form-urlencoded',
                    data: $.param(data),
                    success: () => {
                        alert('Activity updated successfully!');
                    },
                    error: (xhr) => {
                        alert('Failed to update activity: ' + (xhr.responseJSON?.message || 'Unknown error'));
                    },
                    complete: hideSpinner
                });
            });
        });

document.getElementById('bulkDelete').addEventListener('click', () => {
        const selected = Array.from(document.querySelectorAll('.selectRow:checked')).map(cb => cb.value);
        if (selected.length === 0) {
            alert('Please select at least one activity to delete.');
            return;
        }
        if (confirm(`Are you sure you want to delete ${selected.length} activities?`)) {
            showSpinner();
            $.ajax({
                url: '/delete/bulk',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(selected),
                success: () => {
                    window.location.reload();
                },
                error: () => {
                    alert('Failed to delete activities.');
                },
                complete: hideSpinner
            });
        }
    });

        document.getElementById('selectAll').addEventListener('change', (e) => {
            document.querySelectorAll('.selectRow').forEach(cb => cb.checked = e.target.checked);
        });

        document.getElementById('exportCsv').addEventListener('click', () => {
            const rows = [];
            const headers = Array.from(document.querySelectorAll('th[data-col]')).map(th => th.dataset.col);
            rows.push(headers.join(','));
            document.querySelectorAll('#activityTable tr').forEach(row => {
                const cells = Array.from(row.querySelectorAll('td.editable')).map(cell => `"${cell.textContent.replace(/"/g, '""')}"`);
                if (cells.length > 0) {
                    rows.push(cells.join(','));
                }
            });
            const csv = rows.join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'activities.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        });

        document.getElementById('saveColumns').addEventListener('click', () => {
            const visibleColumns = Array.from(document.querySelectorAll('.column-toggle:checked')).map(cb => cb.value);
            localStorage.setItem('visibleColumns', JSON.stringify(visibleColumns));
            applyColumnVisibility();
            $('#columnModal').modal('hide');
        });

        function applyColumnVisibility() {
            const visibleColumns = JSON.parse(localStorage.getItem('visibleColumns')) || 
                                  ['state', 'stationName', 'activityType', 'eventCategory', 'participantCategory', 
                                   'eventDescription', 'schoolOrCollegeOrPanchayatName', 'eventLocation', 
                                   'eventDate', 'numberOfParticipants', 'remarks'];
            document.querySelectorAll('th[data-col], td[data-field]').forEach(el => {
                const col = el.dataset.col || el.dataset.field;
                el.style.display = visibleColumns.includes(col) ? '' : 'none';
            });
        }
        applyColumnVisibility();

        let stateChart, categoryChart;
        document.getElementById('toggleAnalytics').addEventListener('click', () => {
            const analyticsSection = document.getElementById('analytics-section');
            const isVisible = analyticsSection.style.display !== 'none';
            analyticsSection.style.display = isVisible ? 'none' : 'block';
            if (!isVisible && !stateChart) {
                initializeCharts();
            }
        });

        function initializeCharts() {
            const activities = Array.from(document.querySelectorAll('#activityTable tr')).map(row => ({
                state: row.querySelector('[data-field="state"]').textContent,
                eventCategory: row.querySelector('[data-field="eventCategory"]').textContent
            }));

            const stateCounts = activities.reduce((acc, act) => {
                acc[act.state] = (acc[act.state] || 0) + 1;
                return acc;
            }, {});
            const categoryCounts = activities.reduce((acc, act) => {
                acc[act.eventCategory] = (acc[act.eventCategory] || 0) + 1;
                return acc;
            }, {});

            stateChart = new Chart(document.getElementById('stateChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(stateCounts),
                    datasets: [{
                        label: 'Activities by State',
                        data: Object.values(stateCounts),
                        backgroundColor: ['rgba(54, 162, 235, 0.6)', 'rgba(100, 181, 246, 0.6)', 'rgba(153, 204, 255, 0.6)'],
                        borderColor: ['rgba(54, 162, 235, 1)', 'rgba(100, 181, 246, 1)', 'rgba(153, 204, 255, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: { y: { beginAtZero: true } }
                }
            });

            categoryChart = new Chart(document.getElementById('categoryChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(categoryCounts),
                    datasets: [{
                        label: 'Activities by Category',
                        data: Object.values(categoryCounts),
                        backgroundColor: ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEEAD', '#D4A5A5', '#9B59B6']
                    }]
                }
            });
        }

        document.querySelectorAll('.delete-files').forEach(button => {
            button.addEventListener('click', () => {
                const activityId = button.dataset.id;
                if (confirm('Are you sure you want to delete all images for this activity?')) {
                    showSpinner();
                    fetch(`/activities/files/${activityId}`, {
                        method: 'DELETE'
                    }).then(response => {
                        if (response.ok) {
                            const dropdown = button.closest('.dropdown');
                            const disabledButton = dropdown.parentElement.querySelector('.download-btn[disabled]');
                            dropdown.remove();
                            if (disabledButton) {
                                disabledButton.style.display = 'block';
                            }
                            alert('All images deleted successfully!');
                        } else {
                            alert('Failed to delete images.');
                        }
                    }).catch(error => {
                        console.error('Delete images failed:', error);
                        alert('Failed to delete images.');
                    }).finally(hideSpinner);
                }
            });
        });

        const eventSource = new EventSource('/activities/updates');
        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.action === 'HEARTBEAT') return;

            if (data.action === 'ADD' || data.action === 'UPDATE') {
                const row = document.querySelector(`tr .activity-id:contains('${data.activity.id}')`);
                const files = data.files || [];
                const downloadCell = row ? row.querySelector('.actions') : null;
                if (row && data.action === 'UPDATE') {
                    row.querySelector('[data-field="state"]').textContent = data.activity.state;
                    row.querySelector('[data-field="stationName"]').textContent = data.activity.stationName;
                    row.querySelector('[data-field="activityType"]').textContent = data.activity.activityType;
                    row.querySelector('[data-field="eventCategory"]').textContent = data.activity.eventCategory;
                    row.querySelector('[data-field="participantCategory"]').textContent = data.activity.participantCategory;
                    row.querySelector('[data-field="eventDescription"]').innerHTML = data.activity.eventDescription;
                    row.querySelector('[data-field="schoolOrCollegeOrPanchayatName"]').textContent = data.activity.schoolOrCollegeOrPanchayatName;
                    row.querySelector('[data-field="eventLocation"]').textContent = data.activity.eventLocation;
                    row.querySelector('[data-field="eventDate"]').textContent = data.activity.eventDate;
                    row.querySelector('[data-field="numberOfParticipants"]').textContent = data.activity.numberOfParticipants;
                    row.querySelector('[data-field="remarks"]').innerHTML = data.activity.remarks;

                    if (downloadCell) {
                        const existingDropdown = downloadCell.querySelector('.dropdown');
                        const disabledButton = downloadCell.querySelector('.download-btn[disabled]');
                        if (files.length > 0) {
                            if (existingDropdown) {
                                existingDropdown.querySelector('.dropdown-menu').innerHTML = files.map(file => 
                                    `<a class="dropdown-item" href="/api/download/${file.id}">${file.fileName}</a>`
                                ).join('') + '<div class="dropdown-divider"></div><a class="dropdown-item text-danger delete-files" data-id="' + data.activity.id + '">Delete All Images</a>';
                            } else {
                                const dropdown = document.createElement('div');
                                dropdown.className = 'dropdown';
                                dropdown.innerHTML = `
                                    <button class="btn btn-sm btn-primary download-btn" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" data-id="${data.activity.id}">
                                        Download
                                    </button>
                                    <div class="dropdown-menu">
                                        ${files.map(file => `<a class="dropdown-item" href="/api/download/${file.id}">${file.fileName}</a>`).join('')}
                                        <div class="dropdown-divider"></div>
                                        <a class="dropdown-item text-danger delete-files" data-id="${data.activity.id}">Delete All Images</a>
                                    </div>`;
                                if (disabledButton) disabledButton.remove();
                                downloadCell.appendChild(dropdown);
                            }
                        } else {
                            if (existingDropdown) existingDropdown.remove();
                            if (!disabledButton) {
                                const disabledBtn = document.createElement('button');
                                disabledBtn.className = 'btn btn-sm btn-primary download-btn';
                                disabledBtn.disabled = true;
                                disabledBtn.textContent = 'Download';
                                disabledBtn.dataset.id = data.activity.id;
                                disabledBtn.setAttribute('aria-label', `No images available for activity ${data.activity.id}`);
                                downloadCell.appendChild(disabledBtn);
                            }
                        }
                    }
                } else if (data.action === 'ADD') {
                    window.location.reload();
                }
            } else if (data.action === 'DELETE') {
                data.deletedIds.forEach(id => {
                    const row = document.querySelector(`tr .activity-id:contains('${id}')`);
                    if (row) row.remove();
                });
            }
        };
        eventSource.onerror = function() {
            console.error('SSE connection error');
            eventSource.close();
            setTimeout(() => {
                window.location.reload();
            }, 5000);
        };

        let timeoutId;
        function resetSessionTimer() {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => {
                document.querySelector('.session-warning').style.display = 'block';
                setTimeout(() => {
                    window.location.href = '/';
                }, 60000);
            }, 15 * 60 * 1000);
        }
        document.getElementById('extendSession').addEventListener('click', () => {
            document.querySelector('.session-warning').style.display = 'none';
            resetSessionTimer();
            fetch('/extend-session', { method: 'POST' })
                .catch(error => console.error('Session extension failed:', error));
        });
        document.addEventListener('mousemove', resetSessionTimer);
        document.addEventListener('keydown', resetSessionTimer);
        resetSessionTimer();
    </script>
</body>
</html>

